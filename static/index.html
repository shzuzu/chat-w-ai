<!doctype html>
<html lang="ru">
    <head>
        <style>
            @import url("https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap");
        </style>
        <meta charset="UTF-8" />
        <!-- Правильный viewport для мобильных устройств -->
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
        />
        <title>AI Chat</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
        />
        <link
            rel="icon"
            type="image/png"
            href="/image/favicon-96x96.png"
            sizes="96x96"
        />
        <link rel="icon" type="image/svg+xml" href="/image/favicon.svg" />
        <link rel="shortcut icon" href="/image/favicon.ico" />
        <link
            rel="apple-touch-icon"
            sizes="180x180"
            href="/image/apple-touch-icon.png"
        />
        <meta name="apple-mobile-web-app-title" content="AI Chat" />
        <link rel="manifest" href="/image/site.webmanifest" />
    </head>
    <link rel="stylesheet" href="style.css" />
    <body>
        <div class="container-fluid h-100 p-0">
            <div class="row g-0 h-100">
                <!-- Server Icons Column -->
                <div class="col-auto server-column" id="server-column">
                    <div class="server-list">
                        <!-- Мобильный заголовок с кнопкой закрытия -->
                        <div
                            class="mobile-server-title d-md-none p-3 position-relative"
                        >
                            Выберите ИИ:
                            <button
                                id="close-server-list"
                                class="btn btn-link text-white position-absolute end-0 top-50 translate-middle-y me-3"
                            >
                                <i class="bi bi-x-lg fs-4"></i>
                            </button>
                        </div>
                        <!-- Основной чат (GigaChat) -->
                        <div
                            class="server-icon active"
                            data-model="gigachat"
                            id="giga-server-icon"
                            onclick="window.location.href='/'"
                        >
                            <svg
                                version="1.0"
                                xmlns="http://www.w3.org/2000/svg"
                                width="300.000000pt"
                                height="152.000000pt"
                                viewBox="0 0 300.000000 152.000000"
                                preserveAspectRatio="xMidYMid meet"
                            >
                                <g
                                    transform="translate(0.000000,152.000000) scale(0.100000,-0.100000)"
                                    fill="#ffffff"
                                    stroke="none"
                                >
                                    <path
                                        d="M433 1116 c-121 -30 -179 -104 -171 -221 5 -85 38 -134 115 -171 50 -25 72 -29 163 -32 105 -4 117 -2 222 42 11 5 18 1 23 -13 6 -18 14 -21 71 -21 l65 0 -3 118 -3 117 -162 3 -163 2 0 -45 0 -45 60 0 c33 0 60 -4 60 -8 0 -35 -155 -44 -207 -13 -56 35 -56 127 0 162 46 29 160 23 201 -9 25 -19 41 -22 117 -22 48 0 90 4 94 10 10 17 -22 77 -57 103 -19 15 -63 33 -98 41 -78 19 -254 19 -327 2z"
                                    />
                                    <path
                                        d="M1541 1115 c-123 -35 -166 -88 -166 -206 0 -99 27 -144 112 -186 54 -26 66 -28 183 -28 112 0 130 2 169 23 35 19 45 21 52 10 5 -7 9 -16 9 -20 0 -5 29 -8 65 -8 l65 0 0 120 0 120 -165 0 -165 0 0 -45 0 -45 60 0 c33 0 60 -4 60 -8 0 -31 -148 -44 -199 -17 -65 33 -66 135 -1 168 50 26 155 20 194 -11 25 -19 41 -22 117 -22 48 0 90 4 94 10 9 14 -19 72 -46 97 -45 41 -105 55 -249 59 -100 3 -149 0 -189 -11z"
                                    />
                                    <path
                                        d="M950 1060 l0 -60 50 0 50 0 0 -90 0 -90 -50 0 -50 0 0 -60 0 -60 195 0 195 0 0 59 0 60 -47 3 -48 3 0 85 0 85 48 3 47 3 0 60 0 59 -195 0 -195 0 0 -60z"
                                    />
                                    <path
                                        d="M2215 1058 c-16 -35 -59 -126 -97 -203 -37 -77 -68 -143 -68 -147 0 -5 43 -8 95 -8 92 0 96 1 107 25 11 25 13 25 128 25 115 0 117 0 128 -25 11 -24 14 -25 117 -25 58 0 105 2 105 5 0 3 -48 97 -106 210 l-106 205 -137 0 -137 0 -29 -62z m194 -117 c11 -27 21 -54 21 -60 0 -7 -23 -11 -55 -11 -30 0 -55 2 -55 4 0 13 53 116 60 116 4 0 17 -22 29 -49z"
                                    />
                                    <path
                                        d="M495 659 c-165 -16 -244 -87 -245 -218 0 -148 108 -221 327 -221 50 0 116 5 145 11 103 21 178 85 178 152 l0 27 -94 0 c-92 0 -95 -1 -126 -31 -30 -30 -33 -31 -106 -27 -69 3 -79 6 -100 31 -32 37 -32 90 -1 121 46 45 169 45 214 0 22 -22 32 -24 118 -24 89 0 95 1 95 21 0 27 -16 57 -48 92 -49 52 -205 81 -357 66z"
                                    />
                                    <path
                                        d="M937 654 c-4 -4 -7 -101 -7 -216 l0 -208 100 0 100 0 0 75 0 75 120 0 119 0 3 -72 3 -73 98 -3 97 -3 -2 213 -3 213 -95 0 -95 0 -3 -72 -3 -73 -119 0 -119 0 -3 73 -3 72 -90 3 c-50 1 -94 0 -98 -4z"
                                    />
                                    <path
                                        d="M1754 588 c-20 -40 -67 -137 -105 -215 l-68 -143 97 0 97 0 17 30 17 30 110 0 110 0 16 -30 16 -30 105 0 c58 0 104 4 102 8 -13 31 -203 400 -211 410 -7 8 -47 12 -138 12 l-129 0 -36 -72z m191 -114 c14 -31 25 -60 25 -65 0 -5 -25 -9 -55 -9 -30 0 -55 4 -55 10 0 10 52 120 57 120 2 0 14 -25 28 -56z"
                                    />
                                    <path
                                        d="M2154 646 c-3 -7 -4 -38 -2 -67 l3 -54 93 -3 92 -3 0 -144 0 -145 95 0 94 0 3 143 3 142 93 3 93 3 -3 67 -3 67 -278 3 c-229 2 -278 0 -283 -12z"
                                    />
                                </g>
                            </svg>
                        </div>
                        <!-- Альтернативная модель (Grok) -->
                        <div
                            class="server-icon"
                            data-model="grok"
                            id="grok-server-icon"
                        >
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                xmlns:xlink="http://www.w3.org/1999/xlink"
                                viewBox="0,0,256,256"
                                width="48px"
                                height="48px"
                                fill-rule="nonzero"
                            >
                                <g
                                    fill="#ffffff"
                                    fill-rule="nonzero"
                                    stroke="none"
                                    stroke-width="1"
                                    stroke-linecap="butt"
                                    stroke-linejoin="miter"
                                    stroke-miterlimit="10"
                                    stroke-dasharray=""
                                    stroke-dashoffset="0"
                                    font-family="none"
                                    font-weight="none"
                                    font-size="none"
                                    text-anchor="none"
                                    style="mix-blend-mode: normal"
                                >
                                    <g transform="scale(5.33333,5.33333)">
                                        <path
                                            d="M18.542,30.532l15.956,-11.776c0.783,-0.576 1.902,-0.354 2.274,0.545c1.962,4.728 1.084,10.411 -2.819,14.315c-3.903,3.901 -9.333,4.756 -14.299,2.808l-5.423,2.511c7.778,5.315 17.224,4 23.125,-1.903c4.682,-4.679 6.131,-11.058 4.775,-16.812l0.011,0.011c-1.966,-8.452 0.482,-11.829 5.501,-18.735c0.116,-0.164 0.237,-0.33 0.357,-0.496l-6.602,6.599v-0.022l-22.86,22.958M15.248,33.392c-5.582,-5.329 -4.619,-13.579 0.142,-18.339c3.521,-3.522 9.294,-4.958 14.331,-2.847l5.412,-2.497c-0.974,-0.704 -2.224,-1.46 -3.659,-1.994c-6.478,-2.666 -14.238,-1.34 -19.505,3.922c-5.065,5.064 -6.659,12.851 -3.924,19.496c2.044,4.965 -1.307,8.48 -4.682,12.023c-1.199,1.255 -2.396,2.514 -3.363,3.844l15.241,-13.608"
                                        ></path>
                                    </g>
                                </g>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Channels Column -->
                <div class="col-auto sidebar" id="sidebar" style="width: 220px">
                    <div class="channel-list">
                        <div class="p-3 fw-bold fs-5" id="ai-model-title">
                            GigaChat AI
                        </div>
                        <div class="channel-category" id="chat-category">
                            <div>
                                <i
                                    class="fa-solid fa-chevron-down me-1 chevron-icon"
                                    id="category-chevron"
                                ></i>
                                ЧАТЫ
                            </div>
                            <div
                                class="add-chat-btn"
                                data-bs-toggle="modal"
                                data-bs-target="#newChatModal"
                            >
                                <i class="fa-solid fa-plus"></i>
                            </div>
                        </div>

                        <div class="channels-container" id="channels-container">
                            <div
                                class="channel-item active"
                                data-chat-id="general"
                            >
                                <i class="fa-solid fa-hashtag channel-icon"></i>
                                общий-чат
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat Area Column -->
                <div class="col">
                    <div class="chat-area">
                        <div class="chat-header">
                            <button
                                class="btn btn-link text-decoration-none d-md-none me-2"
                                id="toggle-sidebar"
                            >
                                <i
                                    class="fa-solid fa-bars"
                                    style="color: var(--discord-light)"
                                ></i>
                            </button>
                            <i class="fa-solid fa-hashtag me-2"></i>
                            <span class="fw-bold" id="current-chat-name"
                                >общий-чат</span
                            >
                        </div>

                        <div class="chat-messages" id="chat-messages">
                            <div class="message assistant-message">
                                <div class="message-avatar">G</div>
                                <div class="message-content">
                                    <div class="message-author">GigaChat</div>
                                    <div class="message-text">
                                        Привет! Я GigaChat. Чем могу помочь?
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="loading-indicator" id="loading-indicator">
                            <div class="spinner"></div>
                            <div>AI печатает...</div>
                        </div>

                        <div class="chat-input-area">
                            <input
                                type="text"
                                class="chat-input"
                                id="message-input"
                                placeholder="Напишите сообщение..."
                                autocomplete="on"
                            />
                            <div class="send-button" id="send-button">
                                <i class="bi bi-arrow-up"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Overlay for mobile navigation -->
        <div class="overlay" id="overlay"></div>

        <!-- Mobile Navigation -->
        <div class="mobile-nav">
            <button class="nav-btn" id="show-servers">
                <i class="fa-solid fa-server"></i>
            </button>
            <button class="nav-btn" id="show-channels">
                <i class="fa-solid fa-hashtag"></i>
            </button>
            <button class="nav-btn active" id="show-chat">
                <i class="fa-solid fa-comment"></i>
            </button>
        </div>

        <!-- Modal for creating new chat -->
        <div
            class="modal fade"
            id="newChatModal"
            tabindex="-1"
            aria-labelledby="newChatModalLabel"
            aria-hidden="true"
        >
            <div class="modal-dialog modal-dialog-centered">
                <div
                    class="modal-content bg-dark text-light border border-secondary"
                >
                    <div class="modal-header border-secondary">
                        <h5 class="modal-title" id="newChatModalLabel">
                            Создать новый чат
                        </h5>
                        <button
                            type="button"
                            class="btn-close btn-close-white"
                            data-bs-dismiss="modal"
                            aria-label="Close"
                        ></button>
                    </div>

                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="chat-name" class="form-label"
                                >Название чата</label
                            >
                            <input
                                type="text"
                                class="form-control bg-dark text-light border-secondary"
                                id="chat-name"
                                placeholder="Введите название чата"
                            />
                        </div>
                    </div>

                    <div class="modal-footer border-secondary">
                        <button
                            type="button"
                            class="btn btn-outline-danger"
                            data-bs-dismiss="modal"
                        >
                            Отмена
                        </button>
                        <button
                            type="button"
                            class="btn btn-primary"
                            id="create-chat-btn"
                        >
                            Создать
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal for confirming chat deletion -->
        <div
            class="modal fade"
            id="deleteChatModal"
            tabindex="-1"
            aria-labelledby="deleteChatModalLabel"
            aria-hidden="true"
            data-bs-theme="dark"
        >
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content bg-dark text-light">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteChatModalLabel">
                            Удалить чат
                        </h5>
                        <button
                            type="button"
                            class="btn-close btn-close-white"
                            data-bs-dismiss="modal"
                            aria-label="Close"
                        ></button>
                    </div>
                    <div class="modal-body">
                        <p>
                            Вы уверены, что хотите удалить чат "<span
                                id="delete-chat-name"
                            ></span
                            >"?
                        </p>
                        <p>
                            Это действие нельзя отменить, и вся история
                            сообщений будет потеряна.
                        </p>
                    </div>
                    <div class="modal-footer">
                        <button
                            type="button"
                            class="btn btn-secondary"
                            data-bs-dismiss="modal"
                        >
                            Отмена
                        </button>
                        <button
                            type="button"
                            class="btn btn-outline-danger"
                            id="confirm-delete-btn"
                        >
                            Удалить
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <script>
            const titleElement = document.getElementById("ai-model-title");
            const path = window.location.pathname;
            if (path === "/") {
                titleElement.textContent = "GigaChat";
            } else if (path === "/grok") {
                titleElement.textContent = "Grok";
            }
        </script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.5/purify.min.js"></script>
        <!-- Подсветка синтаксиса -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css"
        />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="script.js"></script>
        <script>
            // Автоматическая подсветка при загрузке и после динамического контента
            document.addEventListener("DOMContentLoaded", function () {
                hljs.highlightAll();

                // Для динамически добавленного контента
                const observer = new MutationObserver((mutations) => {
                    hljs.highlightAll();
                });
            });
        </script>
    </body>
</html>
